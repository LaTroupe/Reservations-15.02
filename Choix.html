<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Réservation Théâtre</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        .seat { 
            display: inline-block; 
            width: 30px; 
            height: 30px; 
            background: #4CAF50; 
            margin: 5px; 
            cursor: pointer; 
            text-align: center;
            line-height: 30px;
        }
        .selected { background: #f44336; }
        .reserved { background: #666; cursor: not-allowed; }
        #reservationForm { margin-top: 20px; }
        input, button { margin: 10px 0; padding: 10px; width: 100%; }
    </style>
</head>
<body>
    <h1>Réservation de places</h1>
    
    <!-- Sélecteur de places -->
    <div id="seatMap"></div>
    
    <!-- Formulaire -->
    <form id="reservationForm">
        <input type="text" id="name" placeholder="Nom complet" required>
        <input type="email" id="email" placeholder="email@exemple.com" required>
        <button type="submit">Confirmer la réservation</button>
    </form>

    <!-- Résultats -->
    <div id="result"></div>

    <script>
        // Génération des places
        const seatMap = document.getElementById('seatMap');
        let selectedSeats = [];
        
        for(let i = 1; i <= 30; i++) {
            const seat = document.createElement('div');
            seat.className = 'seat';
            seat.textContent = i;
            seat.onclick = () => toggleSeat(i, seat);
            seatMap.appendChild(seat);
        }

        function toggleSeat(number, element) {
            if(element.classList.contains('reserved')) return;
            
            element.classList.toggle('selected');
            const index = selectedSeats.indexOf(number);
            
            if(index === -1) {
                selectedSeats.push(number);
            } else {
                selectedSeats.splice(index, 1);
            }
        }

        // Gestion du formulaire
        document.getElementById('reservationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const payload = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                seats: selectedSeats.join(',')
            };

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbyWdcYiJK3mvZQVmcOomP2GJsNYCnNvFqXHbyXf0T2NSb3Pc99iBr4HebfOdlVoLuG8cA/exec', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                if(result.status === 'success') {
                    document.getElementById('result').innerHTML = `
                        <div style="color: green; margin: 20px 0;">
                            ✔️ ${result.message}
                        </div>
                    `;
                    
                    // Marquer les places comme réservées
                    selectedSeats.forEach(seat => {
                        document.querySelectorAll('.seat')[seat-1].classList.add('reserved');
                    });
                    
                    // Réinitialiser
                    selectedSeats = [];
                    e.target.reset();
                    
                } else {
                    throw new Error(result.message);
                }

            } catch (error) {
  document.getElementById('result').innerHTML = `
    <div style="color: red; margin: 20px 0;">
      ❌ Erreur : ${error.message || "Problème de communication avec le serveur"}
    </div>
                `;
            }
        });
    </script>
</body>
</html>
